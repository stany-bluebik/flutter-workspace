"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractFromZipStream = void 0;
const tslib_1 = require("tslib");
const unzipper_1 = require("unzipper");
function extractFromZipStream(zipStream, forEach) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        return zipStream.pipe((0, unzipper_1.Parse)())
            .on('entry', (e) => tslib_1.__awaiter(this, void 0, void 0, function* () {
            const entryPath = e.path;
            try {
                const entryContent = yield e.buffer();
                const entryType = e.type; // 'Directory' or 'File'
                if (entryType === 'File') {
                    forEach(entryPath, entryContent);
                }
                else {
                    e.autodrain();
                }
            }
            catch (error) {
                console.error(`Error while unzipping item at '${entryPath}', error: ${error}`);
            }
        }))
            .promise();
    });
}
exports.extractFromZipStream = extractFromZipStream;
//# sourceMappingURL=zip-utils.js.map